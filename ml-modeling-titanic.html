<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Software Carpentry: xwMOOC 기계학습</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="Software Carpentry Blog" href="http://software-carpentry.org/feed.xml"/>
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-59802572-17', 'auto');
      ga('send', 'pageview');
    
    </script>
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://software-carpentry.org" title="Software Carpentry">
          <img alt="Software Carpentry banner" src="img/software-carpentry-banner.png" />
        </a>
      </div>
      <article>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
                    <a href="index.html"><h1 class="title">xwMOOC 기계학습</h1></a>
          <h2 class="subtitle">전통방식 모형개발 - 타이타닉 생존 데이터</h2>
          <section class="objectives panel panel-warning">
<div class="panel-heading">
<h2 id="학습목표"><span class="glyphicon glyphicon-certificate"></span>학습목표</h2>
</div>
<div class="panel-body">
<ul>
<li>전통방식 모형개발 방식을 타이타닉 생존데이터에 적용한다.</li>
<li>CMM 3수준에 해당되는 모형개발 방식으로 간주할 수도 있다.</li>
</ul>
</div>
</section>
<h2 id="타이타닉-생존-데이터-r-bloggers-logistic">1. 타이타닉 생존 데이터 <a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></h2>
<p>타이타닉 생존데이터는 영화로도 만들어지고, 여러가지 에피소드가 많이 들어있는 소재로 데이터 과학과 통계학적인 측면에서 바라보면 범주형 데이터로 생존여부가 종속변수로 녹아져 있어, 예측모형으로 적합시키기도 적절한 데이터이기도 하다.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/9xoqXVjBEF8" frameborder="0" allowfullscreen>
</iframe>
<h3 id="타이타닉-생존-데이터-가져오기-r-blogger-titanic">1.1. 타이타닉 생존 데이터 가져오기 <a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a></h3>
<p><a href="https://www.kaggle.com/c/titanic/data">캐글 타이타닉 데이터</a>를 다운로드 받아 로컬컴퓨터에서 불러읽어오거나, GitHub 사이트에서 캐글 타이타닉 데이터를 올려놓은 것을 바로 불러온다. 캐글 타이나틱 생존 데이터는 <code>train.csv</code>와 <code>test.csv</code>로 나눠져 있는데 일단 모두 합쳐 하나의 데이터셋으로 만들고 난후에 동일하게 전처리 작업을 하고 전통적 방식으로 예측하는 방법을 전개한다.</p>
<table style="width:64%;">
<colgroup>
<col width="20%" />
<col width="43%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">변수명</th>
<th align="left">변수명 설명</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>survival</strong></td>
<td align="left">Survival (0 = No; 1 = Yes)</td>
</tr>
<tr class="even">
<td align="left">pclass</td>
<td align="left">Passenger Class (1 = 1st; 2 = 2nd; 3 = 3rd)</td>
</tr>
<tr class="odd">
<td align="left">name</td>
<td align="left">Name</td>
</tr>
<tr class="even">
<td align="left">sex</td>
<td align="left">Sex</td>
</tr>
<tr class="odd">
<td align="left">age</td>
<td align="left">Age</td>
</tr>
<tr class="even">
<td align="left">sibsp</td>
<td align="left">Number of Siblings/Spouses Aboard</td>
</tr>
<tr class="odd">
<td align="left">parch</td>
<td align="left">Number of Parents/Children Aboard</td>
</tr>
<tr class="even">
<td align="left">ticket</td>
<td align="left">Ticket Number</td>
</tr>
<tr class="odd">
<td align="left">fare</td>
<td align="left">Passenger Fare</td>
</tr>
<tr class="even">
<td align="left">cabin</td>
<td align="left">Cabin</td>
</tr>
<tr class="odd">
<td align="left">embarked</td>
<td align="left">Port of Embarkation (C = Cherbourg; Q = Queenstown; S = Southampton)</td>
</tr>
</tbody>
</table>
<p><code>survival</code> 이 종속변수이며, 나머지를 예측변수로 사용해서 생존을 예측하는 모형을 개발한다.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">##========================================================
## 01. 데이터 준비
##========================================================
<span class="co"># Titanic: Machine Learning from Disaster, https://www.kaggle.com/c/titanic/data</span>

<span class="kw">suppressMessages</span>(<span class="kw">library</span>(readr))
<span class="kw">suppressMessages</span>(<span class="kw">library</span>(dplyr))
titanic.train.df &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/agconti/kaggle-titanic/master/data/train.csv&quot;</span>)
titanic.test.df &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/agconti/kaggle-titanic/master/data/test.csv&quot;</span>)
titanic &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(titanic.train.df, titanic.test.df)</code></pre></div>
<h2 id="데이터-정제">1.2. 데이터 정제</h2>
<p>타이타닉 생존데이터를 불러온 다음 현황을 파악하고, 결측값에 대한 대응방안을 마련한다. 예를 들어, 결측값이 너무 많은 경우 변수(<code>Cabin</code>) 자체를 제거한다. <code>Name</code>, <code>Ticket</code>처럼 관측점마다 유일한 변수는 정보로서 의미가 없기 때문에 이것도 제거한다. <code>Age</code> 변수는 평균을 매워넣는 것으로 하고, 상대적으로 적은 결측값이 있는 관측점은 <code>Embarked</code>, <code>Fare</code>, <code>Survived</code>는 관측점을 제거하는 방식으로 정제 작업을 수행한다.</p>
<p>특히, <code>Amelia</code> 팩키지의 <code>missmap</code> 함수를 사용해서 결측값 진행 작업을 바로 시각적으로 확인한다.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">##========================================================
## 02. 데이터 정제
##========================================================
<span class="co"># 2.1. 현황 파악</span>
<span class="kw">summary</span>(titanic)</code></pre></div>
<pre class="output"><code>  PassengerId      Survived          Pclass          Name          
 Min.   :   1   Min.   :0.0000   Min.   :1.000   Length:1309       
 1st Qu.: 328   1st Qu.:0.0000   1st Qu.:2.000   Class :character  
 Median : 655   Median :0.0000   Median :3.000   Mode  :character  
 Mean   : 655   Mean   :0.3838   Mean   :2.295                     
 3rd Qu.: 982   3rd Qu.:1.0000   3rd Qu.:3.000                     
 Max.   :1309   Max.   :1.0000   Max.   :3.000                     
                NA&#39;s   :418                                        
     Sex                 Age            SibSp            Parch      
 Length:1309        Min.   : 0.17   Min.   :0.0000   Min.   :0.000  
 Class :character   1st Qu.:21.00   1st Qu.:0.0000   1st Qu.:0.000  
 Mode  :character   Median :28.00   Median :0.0000   Median :0.000  
                    Mean   :29.88   Mean   :0.4989   Mean   :0.385  
                    3rd Qu.:39.00   3rd Qu.:1.0000   3rd Qu.:0.000  
                    Max.   :80.00   Max.   :8.0000   Max.   :9.000  
                    NA&#39;s   :263                                     
    Ticket               Fare            Cabin          
 Length:1309        Min.   :  0.000   Length:1309       
 Class :character   1st Qu.:  7.896   Class :character  
 Mode  :character   Median : 14.454   Mode  :character  
                    Mean   : 33.295                     
                    3rd Qu.: 31.275                     
                    Max.   :512.329                     
                    NA&#39;s   :1                           
   Embarked        
 Length:1309       
 Class :character  
 Mode  :character  
                   
                   
                   
                   
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(titanic, function(x) <span class="kw">sum</span>(<span class="kw">is.na</span>(x)))</code></pre></div>
<pre class="output"><code>PassengerId    Survived      Pclass        Name         Sex         Age 
          0         418           0           0           0         263 
      SibSp       Parch      Ticket        Fare       Cabin    Embarked 
          0           0           0           1        1014           2 
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(titanic, function(x) <span class="kw">length</span>(<span class="kw">unique</span>(x)))</code></pre></div>
<pre class="output"><code>PassengerId    Survived      Pclass        Name         Sex         Age 
       1309           3           3        1307           2          99 
      SibSp       Parch      Ticket        Fare       Cabin    Embarked 
          7           8         929         282         187           4 
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">suppressMessages</span>(<span class="kw">library</span>(Amelia))
<span class="kw">missmap</span>(titanic, <span class="dt">main =</span> <span class="st">&quot;결측값과 관측값&quot;</span>)</code></pre></div>
<p><img src="fig/titanic-clean-1.png" title="plot of chunk titanic-clean" alt="plot of chunk titanic-clean" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 2.2. 결측값에 대한 응징</span>
<span class="co"># 분석에 사용될 변수만 선정</span>

titanic &lt;-<span class="st"> </span>titanic %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(Survived, Pclass, Sex, Age, SibSp, Parch, Fare, Embarked) %&gt;%<span class="st">  </span><span class="co"># 결측값이 많은 Cabin과 이름, Ticket은 제거</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Age =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(Age), <span class="kw">mean</span>(Age, <span class="dt">na.rm=</span><span class="ot">TRUE</span>), Age)) %&gt;%<span class="st">  </span><span class="co"># 나이를 평균값으로 치환</span>
<span class="st">  </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(Embarked)) %&gt;%<span class="st">  </span><span class="co"># 결측값 2개 행 제거</span>
<span class="st">  </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(Fare)) %&gt;%<span class="st">   </span><span class="co"># 결측값 1개 행 제거</span>
<span class="st">  </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(Survived))   <span class="co"># 결측값 418개 행 제거</span>

<span class="kw">missmap</span>(titanic, <span class="dt">main =</span> <span class="st">&quot;결측값과 관측값&quot;</span>)</code></pre></div>
<p><img src="fig/titanic-clean-2.png" title="plot of chunk titanic-clean" alt="plot of chunk titanic-clean" style="display: block; margin: auto;" /></p>
<h2 id="예측모형-적용">1.3. 예측모형 적용</h2>
<p><code>caret</code> 팩키지 <code>createDataPartition</code> 함수를 사용해서 7:3으로 훈련데이터와 검증데이터로 구분한다.</p>
<p><code>glm</code> 함수에 <code>family=binomial(link='logit')</code> 인자를 넣어 이항회귀모형을 적합시킨다. 특히, 전체 변수를 모두 넣어 <code>Survived ~.</code> 생존을 예측하는 모형을 구축한다.</p>
<p>변수를 선정하는 방법은 여러가지가 있으나, 먼저 <code>anova</code>함수를 사용해서 포화모델에서 유의적인 변수와 그렇지 않는 변수를 구별한다. 비유의적인 변수를 제거하고 <code>logit.reduced.m</code> 축소된 이항회귀모형을 개발한다.</p>
<p>이항회귀식에는 <span class="math inline">\(R^2\)</span> 결정계수가 큰 의미가 없다고 주장하는 경우도 있으나, <code>pscl</code> 팩키지의 기능을 사용하여 계산해본다.</p>
<p><code>ROCR</code> 팩키지를 사용해서 포화모형과 축소모형간에 차이가 있는지 ROC 면적과 더불어 ROC 곡선을 도식화하여 비교한다.</p>
<p>두 모형간에 성능의 차이는 없어 보이며, 4개 모형이 사용된 축약된 모형이 포화모형과 거의 비슷한 성능을 내고 있다.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">##========================================================
## 03. 모형 적합
##========================================================
## 
<span class="kw">suppressMessages</span>(<span class="kw">library</span>(caret))

<span class="co">#---------------------------------------------------------</span>
<span class="co"># 3.1. 훈련데이터와 검증데이터 분리</span>

train.id &lt;-<span class="st"> </span><span class="kw">createDataPartition</span>(titanic$Survived, <span class="dt">p =</span> <span class="fl">0.7</span>)[[<span class="dv">1</span>]] 
titanic.train.df &lt;-<span class="st"> </span>titanic[ train.id,] 
titanic.test.df &lt;-<span class="st"> </span>titanic[-train.id,]

<span class="co">#---------------------------------------------------------</span>
<span class="co"># 3.1. 선형회귀 적합</span>

logit.full.m &lt;-<span class="st"> </span><span class="kw">glm</span>(Survived ~.,<span class="dt">family=</span><span class="kw">binomial</span>(<span class="dt">link=</span><span class="st">&#39;logit&#39;</span>), <span class="dt">data=</span>titanic.train.df)
<span class="kw">summary</span>(logit.full.m)</code></pre></div>
<pre class="output"><code>
Call:
glm(formula = Survived ~ ., family = binomial(link = &quot;logit&quot;), 
    data = titanic.train.df)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.4313  -0.6202  -0.4143   0.6357   2.3568  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  4.667407   0.660690   7.064 1.61e-12 ***
Pclass      -1.007740   0.169957  -5.929 3.04e-09 ***
Sexmale     -2.723194   0.240673 -11.315  &lt; 2e-16 ***
Age         -0.027363   0.009402  -2.910  0.00361 ** 
SibSp       -0.389763   0.134999  -2.887  0.00389 ** 
Parch       -0.156524   0.147544  -1.061  0.28875    
Fare         0.002806   0.002664   1.054  0.29207    
EmbarkedQ    0.254004   0.451591   0.562  0.57380    
EmbarkedS   -0.425267   0.277755  -1.531  0.12575    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 823.67  on 622  degrees of freedom
Residual deviance: 546.80  on 614  degrees of freedom
AIC: 564.8

Number of Fisher Scoring iterations: 5
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#---------------------------------------------------------</span>
<span class="co"># 3.2. 변수선택</span>
<span class="kw">anova</span>(logit.full.m, <span class="dt">test=</span><span class="st">&quot;Chisq&quot;</span>)</code></pre></div>
<pre class="output"><code>Analysis of Deviance Table

Model: binomial, link: logit

Response: Survived

Terms added sequentially (first to last)

         Df Deviance Resid. Df Resid. Dev  Pr(&gt;Chi)    
NULL                       622     823.67              
Pclass    1   69.080       621     754.59 &lt; 2.2e-16 ***
Sex       1  178.833       620     575.75 &lt; 2.2e-16 ***
Age       1    5.110       619     570.64   0.02379 *  
SibSp     1   15.671       618     554.97 7.537e-05 ***
Parch     1    1.097       617     553.88   0.29485    
Fare      1    2.301       616     551.57   0.12928    
Embarked  2    4.773       614     546.80   0.09197 .  
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#---------------------------------------------------------</span>
<span class="co"># 3.3. 최적모형</span>

logit.reduced.m &lt;-<span class="st"> </span><span class="kw">glm</span>(Survived  ~<span class="st"> </span>Pclass+Sex+Age+SibSp, <span class="dt">family=</span><span class="kw">binomial</span>(<span class="dt">link=</span><span class="st">&#39;logit&#39;</span>), <span class="dt">data=</span>titanic.train.df)
<span class="kw">summary</span>(logit.reduced.m)</code></pre></div>
<pre class="output"><code>
Call:
glm(formula = Survived ~ Pclass + Sex + Age + SibSp, family = binomial(link = &quot;logit&quot;), 
    data = titanic.train.df)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.4848  -0.6207  -0.4262   0.6051   2.4995  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  4.625832   0.566180   8.170 3.08e-16 ***
Pclass      -1.082819   0.141618  -7.646 2.07e-14 ***
Sexmale     -2.736644   0.230971 -11.848  &lt; 2e-16 ***
Age         -0.027605   0.009235  -2.989 0.002797 ** 
SibSp       -0.447315   0.127738  -3.502 0.000462 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 823.67  on 622  degrees of freedom
Residual deviance: 554.97  on 618  degrees of freedom
AIC: 564.97

Number of Fisher Scoring iterations: 5
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#---------------------------------------------------------</span>
<span class="co"># 3.3. R^2 결정계수</span>

<span class="kw">suppressMessages</span>(<span class="kw">library</span>(pscl))
<span class="kw">pR2</span>(logit.full.m)</code></pre></div>
<pre class="output"><code>         llh      llhNull           G2     McFadden         r2ML 
-273.4008118 -411.8332933  276.8649629    0.3361372    0.3587950 
        r2CU 
   0.4892052 
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pR2</span>(logit.reduced.m)</code></pre></div>
<pre class="output"><code>         llh      llhNull           G2     McFadden         r2ML 
-277.4863222 -411.8332933  268.6939422    0.3262169    0.3503298 
        r2CU 
   0.4776632 
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#---------------------------------------------------------</span>
<span class="co"># 3.4. 모형 평가</span>

<span class="kw">suppressMessages</span>(<span class="kw">library</span>(ROCR))
<span class="co"># 전체 모형</span>
logit.full.pred &lt;-<span class="st"> </span><span class="kw">predict</span>(logit.full.m, <span class="dt">newdata=</span>titanic.test.df, <span class="dt">type=</span><span class="st">&quot;response&quot;</span>)
logit.full.pr &lt;-<span class="st"> </span><span class="kw">prediction</span>(logit.full.pred, titanic.test.df$Survived)
logit.full.prf &lt;-<span class="st"> </span><span class="kw">performance</span>(logit.full.pr, <span class="dt">measure =</span> <span class="st">&quot;tpr&quot;</span>, <span class="dt">x.measure =</span> <span class="st">&quot;fpr&quot;</span>)
<span class="kw">plot</span>(logit.full.prf)</code></pre></div>
<p><img src="fig/titanic-model-1.png" title="plot of chunk titanic-model" alt="plot of chunk titanic-model" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ROC 면적</span>
logit.full.auc &lt;-<span class="st"> </span><span class="kw">performance</span>(logit.full.pr, <span class="dt">measure =</span> <span class="st">&quot;auc&quot;</span>)
logit.full.auc &lt;-<span class="st"> </span>logit.full.auc@y.values[[<span class="dv">1</span>]]
logit.full.auc</code></pre></div>
<pre class="output"><code>[1] 0.8468524
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 축소 모형</span>
logit.reduced.pred &lt;-<span class="st"> </span><span class="kw">predict</span>(logit.reduced.m, <span class="dt">newdata=</span>titanic.test.df, <span class="dt">type=</span><span class="st">&quot;response&quot;</span>)
logit.reduced.pr &lt;-<span class="st"> </span><span class="kw">prediction</span>(logit.reduced.pred, titanic.test.df$Survived)
logit.reduced.prf &lt;-<span class="st"> </span><span class="kw">performance</span>(logit.reduced.pr, <span class="dt">measure =</span> <span class="st">&quot;tpr&quot;</span>, <span class="dt">x.measure =</span> <span class="st">&quot;fpr&quot;</span>)
<span class="kw">plot</span>(logit.reduced.prf)</code></pre></div>
<p><img src="fig/titanic-model-2.png" title="plot of chunk titanic-model" alt="plot of chunk titanic-model" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ROC 면적</span>
logit.reduced.auc &lt;-<span class="st"> </span><span class="kw">performance</span>(logit.reduced.pr, <span class="dt">measure =</span> <span class="st">&quot;auc&quot;</span>)
logit.reduced.auc &lt;-<span class="st"> </span>logit.reduced.auc@y.values[[<span class="dv">1</span>]]
logit.reduced.auc</code></pre></div>
<pre class="output"><code>[1] 0.8479692
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#---------------------------------------------------------</span>
<span class="co"># 3.5. ROC 면적비교</span>

<span class="kw">plot</span>(logit.full.prf)
<span class="kw">plot</span>(logit.reduced.prf, <span class="dt">add=</span><span class="ot">TRUE</span>, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</code></pre></div>
<p><img src="fig/titanic-model-3.png" title="plot of chunk titanic-model" alt="plot of chunk titanic-model" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">logit.full.auc</code></pre></div>
<pre class="output"><code>[1] 0.8468524
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">logit.reduced.auc</code></pre></div>
<pre class="output"><code>[1] 0.8479692
</code></pre>
<h2 id="자동-모형-선정-방법">1.4. 자동 모형 선정 방법</h2>
<p>만약 <span class="math inline">\(p\)</span>개 변수가 있다면 <span class="math inline">\(2^p\)</span> 만큼 가능한 모형이 존재한다. 모형을 모두 적합시켜 <span class="math inline">\(2^p\)</span> 모형중에서 성능 등 기준조건을 만족하는 최적의 모형을 선정한다. 경우의 수가 너무 많고, 성능이 비슷한 모형을 반복적으로 개발할 우려도 있고 해서, 기준조건(Criterion-based) 방법으로 통해 변수를 추출해 나간다. 즉, 가장 성능이 좋은 변수부터 선택해 나가면서 복잡성과 성능을 최적화한다. 가장 일반적으로 많이 사용되는 방식이 <span class="math inline">\(AIC(Akaike Information Criterion)\)</span>, <span class="math inline">\(BIC(Bayes Information Criterion)\)</span>을 들 수 있다.</p>
<p><span class="math display">\[AIC = -2 ln(L) + 2k \]</span> <span class="math display">\[BIC = -2 ln(L) + k ln(n) \]</span></p>
<p><span class="math inline">\(L\)</span>은 모형에 대한 우도함수 최대값이고, <span class="math inline">\(k\)</span>는 모형에 사용된 추정모수갯수, <span class="math inline">\(n\)</span>은 관측점 갯수가 된다.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">##========================================================
## 04. 변수선택 모형 선정
##========================================================
## 

logit.null.m &lt;-<span class="st"> </span><span class="kw">glm</span>(Survived ~<span class="dv">1</span>, <span class="dt">family=</span><span class="kw">binomial</span>(<span class="dt">link=</span><span class="st">&#39;logit&#39;</span>), <span class="dt">data=</span>titanic.train.df)
logit.full.m &lt;-<span class="st"> </span><span class="kw">glm</span>(Survived ~., <span class="dt">family=</span><span class="kw">binomial</span>(<span class="dt">link=</span><span class="st">&#39;logit&#39;</span>), <span class="dt">data=</span>titanic.train.df)

logit.bic.m &lt;-<span class="st"> </span><span class="kw">step</span>(logit.null.m, <span class="dt">scope=</span><span class="kw">formula</span>(logit.full.m), <span class="dt">direction=</span><span class="st">&quot;both&quot;</span>, <span class="dt">criterion=</span><span class="st">&quot;BIC&quot;</span>, <span class="dt">k=</span><span class="kw">log</span>(<span class="kw">nrow</span>(titanic.train.df)))</code></pre></div>
<pre class="output"><code>Start:  AIC=830.1
Survived ~ 1

           Df Deviance    AIC
+ Sex       1   638.56 651.43
+ Pclass    1   754.59 767.46
+ Fare      1   779.68 792.55
+ Embarked  2   802.96 822.26
&lt;none&gt;          823.67 830.10
+ SibSp     1   819.19 832.06
+ Parch     1   821.96 834.83
+ Age       1   823.35 836.22

Step:  AIC=651.43
Survived ~ Sex

           Df Deviance    AIC
+ Pclass    1   575.75 595.06
+ Fare      1   616.23 635.53
+ SibSp     1   621.54 640.84
+ Embarked  2   623.91 649.65
&lt;none&gt;          638.56 651.43
+ Parch     1   632.62 651.92
+ Age       1   637.62 656.93
- Sex       1   823.67 830.10

Step:  AIC=595.06
Survived ~ Sex + Pclass

           Df Deviance    AIC
+ SibSp     1   564.30 590.03
&lt;none&gt;          575.75 595.06
+ Age       1   570.64 596.38
+ Parch     1   571.41 597.15
+ Embarked  2   566.78 598.95
+ Fare      1   575.28 601.02
- Pclass    1   638.56 651.43
- Sex       1   754.59 767.46

Step:  AIC=590.03
Survived ~ Sex + Pclass + SibSp

           Df Deviance    AIC
+ Age       1   554.97 587.15
&lt;none&gt;          564.30 590.03
+ Fare      1   562.15 594.33
- SibSp     1   575.75 595.06
+ Parch     1   563.50 595.67
+ Embarked  2   557.76 596.36
- Pclass    1   621.54 640.84
- Sex       1   752.69 772.00

Step:  AIC=587.15
Survived ~ Sex + Pclass + SibSp + Age

           Df Deviance    AIC
&lt;none&gt;          554.97 587.15
- Age       1   564.30 590.03
+ Fare      1   553.36 591.97
+ Parch     1   553.88 592.48
+ Embarked  2   548.78 593.82
- SibSp     1   570.64 596.38
- Pclass    1   621.54 647.27
- Sex       1   733.19 758.93
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">logit.aic.m &lt;-<span class="st"> </span><span class="kw">step</span>(logit.null.m, <span class="dt">scope=</span><span class="kw">formula</span>(logit.full.m), <span class="dt">direction=</span><span class="st">&quot;both&quot;</span>, <span class="dt">criterion=</span><span class="st">&quot;AIC&quot;</span>, <span class="dt">k=</span><span class="dv">2</span>)</code></pre></div>
<pre class="output"><code>Start:  AIC=825.67
Survived ~ 1

           Df Deviance    AIC
+ Sex       1   638.56 642.56
+ Pclass    1   754.59 758.59
+ Fare      1   779.68 783.68
+ Embarked  2   802.96 808.96
+ SibSp     1   819.19 823.19
&lt;none&gt;          823.67 825.67
+ Parch     1   821.96 825.96
+ Age       1   823.35 827.35

Step:  AIC=642.56
Survived ~ Sex

           Df Deviance    AIC
+ Pclass    1   575.75 581.75
+ Fare      1   616.23 622.23
+ SibSp     1   621.54 627.54
+ Embarked  2   623.91 631.91
+ Parch     1   632.62 638.62
&lt;none&gt;          638.56 642.56
+ Age       1   637.62 643.62
- Sex       1   823.67 825.67

Step:  AIC=581.75
Survived ~ Sex + Pclass

           Df Deviance    AIC
+ SibSp     1   564.30 572.30
+ Embarked  2   566.78 576.78
+ Age       1   570.64 578.64
+ Parch     1   571.41 579.41
&lt;none&gt;          575.75 581.75
+ Fare      1   575.28 583.28
- Pclass    1   638.56 642.56
- Sex       1   754.59 758.59

Step:  AIC=572.3
Survived ~ Sex + Pclass + SibSp

           Df Deviance    AIC
+ Age       1   554.97 564.97
+ Embarked  2   557.76 569.76
+ Fare      1   562.15 572.15
&lt;none&gt;          564.30 572.30
+ Parch     1   563.50 573.50
- SibSp     1   575.75 581.75
- Pclass    1   621.54 627.54
- Sex       1   752.69 758.69

Step:  AIC=564.97
Survived ~ Sex + Pclass + SibSp + Age

           Df Deviance    AIC
+ Embarked  2   548.78 562.78
&lt;none&gt;          554.97 564.97
+ Fare      1   553.36 565.36
+ Parch     1   553.88 565.88
- Age       1   564.30 572.30
- SibSp     1   570.64 578.64
- Pclass    1   621.54 629.54
- Sex       1   733.19 741.19

Step:  AIC=562.78
Survived ~ Sex + Pclass + SibSp + Age + Embarked

           Df Deviance    AIC
&lt;none&gt;          548.78 562.78
+ Fare      1   547.95 563.95
+ Parch     1   548.04 564.04
- Embarked  2   554.97 564.97
- Age       1   557.76 569.76
- SibSp     1   561.65 573.65
- Pclass    1   609.59 621.59
- Sex       1   715.28 727.28
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">logit.bic.m</code></pre></div>
<pre class="output"><code>
Call:  glm(formula = Survived ~ Sex + Pclass + SibSp + Age, family = binomial(link = &quot;logit&quot;), 
    data = titanic.train.df)

Coefficients:
(Intercept)      Sexmale       Pclass        SibSp          Age  
    4.62583     -2.73664     -1.08282     -0.44731     -0.02761  

Degrees of Freedom: 622 Total (i.e. Null);  618 Residual
Null Deviance:      823.7 
Residual Deviance: 555  AIC: 565
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">logit.aic.m</code></pre></div>
<pre class="output"><code>
Call:  glm(formula = Survived ~ Sex + Pclass + SibSp + Age + Embarked, 
    family = binomial(link = &quot;logit&quot;), data = titanic.train.df)

Coefficients:
(Intercept)      Sexmale       Pclass        SibSp          Age  
    4.89519     -2.67361     -1.09774     -0.40635     -0.02742  
  EmbarkedQ    EmbarkedS  
    0.29854     -0.46714  

Degrees of Freedom: 622 Total (i.e. Null);  616 Residual
Null Deviance:      823.7 
Residual Deviance: 548.8    AIC: 562.8
</code></pre>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="http://www.r-bloggers.com/how-to-perform-a-logistic-regression-in-r/">R-bloggers, How to perform a Logistic Regression in R</a><a href="#fnref1">↩</a></p></li>
<li id="fn2"><p><a href="http://www.r-bloggers.com/how-to-perform-a-logistic-regression-in-r/">How to perform a Logistic Regression in R</a><a href="#fnref2">↩</a></p></li>
</ol>
</div>
        </div>
      </div>
      </article>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/swcarpentry/lesson-template">Source</a>
        <a class="label swc-blue-bg" href="mailto:admin@software-carpentry.org">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
    <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
  </body>
</html>
