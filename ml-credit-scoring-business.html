<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Software Carpentry: xwMOOC 기계학습</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="Software Carpentry Blog" href="http://software-carpentry.org/feed.xml"/>
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-59802572-17', 'auto');
      ga('send', 'pageview');
    
    </script>
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://software-carpentry.org" title="Software Carpentry">
          <img alt="Software Carpentry banner" src="img/software-carpentry-banner.png" />
        </a>
      </div>
      <article>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
                    <a href="index.html"><h1 class="title">xwMOOC 기계학습</h1></a>
          <h2 class="subtitle">신용평점모형 개발</h2>
          <p><code>{r, include=FALSE} source(&quot;tools/chunk-options.R&quot;)</code></p>
<section class="getready panel panel-warning">
<div class="panel-heading">
<h3 id="신용평가모형-목표"><span class="glyphicon glyphicon-check"></span>신용평가모형 목표</h3>
</div>
<div class="panel-body">
<ul>
<li><strong>수익을 극대화</strong> 하고, <strong>신용위험을 최소화</strong> 하는 신용평점모형을 개발한다.</li>
<li>랜딩클럽 데이터를 분석하여 실제 데이터를 가지고 신용평점모형을 개발한다.</li>
</ul>
</div>
</section>
<h3 id="신용평점모형-ml-credit-scoring-sharma">1. 신용평점모형 <a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></h3>
<p>대한민국에서 이영애 누님께서 IMF를 극복하고 2000년대 초반에 신용카드로 행복한 삶을 사는 모습을 러닝머신을 타면서 보여주면서 신용카드의 전성기가 도래했지만, 소수의 사람을 빼고 신용카드가 결국 미래 소비를 현재로 앞당겨서 돈을 쓰는 것에 불과하다는 것은 그로부터 몇년 뒤에 명확해졌고, 이를 신용대란이라고 불렀다. 이후 기업금융과 마찬가지로 소매금융도 위험관리가 중요해졌으며, 소매금융에 있어 위험관리 기법으로 신용평점에 따라 엄격하게 관리하는 것이 필요해졌고, 이에 <a href="https://ko.wikipedia.org/wiki/신용_위험">신용평점모형(Credit Scoring Model)</a>과 더불어 이를 자동화한 금융시스템이 각광을 받기 시작했다.</p>
<p>파이썬은 과학컴퓨팅에 많은 경험과 라이브러리가 구축되어 있는 반면, R은 상대적으로 통계학기반이라 통계학이 많이 사용되는 금융위험관리 분야에 구축된 블로그, 논문, 기고문, 라이브러리가 많다. 현실과 밀접한 신용할당문제를 기계학습에서 대규모 적용할 경우 풀어가는 방식을 R로 살펴보고, 추후 파이썬으로 확장도 고려해 본다. <a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> <a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a> <a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a></p>
<h4 id="신용평점-개요">1.1. 신용평점 개요</h4>
<p>기본적으로 금융기관에서는 한국은행을 비롯한 다양한 곳에서 자금을 조달하여 이를 관리하고 있다가 자금을 필요로 하는 곳에 자금을 빌려주고 이에 상응하는 이자를 받아 수익을 얻는 것으로 볼 수 있다. 근본적으로 많은 금액을 빌려주고 이를 나누어서 자금을 사용한 곳에서 갚아 나가는 구조다.</p>
<p><img src="fig/ml-credit-biz.png" alt="금융 사업 개요" width="70%" /></p>
<p>물론 다수의 고객에게 자금을 빌려주다보니 제때 돈을 갚지 못하거나, 불의의 사고, 실직 등 다양한 이유로 인해서 돈을 갖지 못하는 위험이 발생된다. 이때 기대손실(Expected Loss)을 다음 구성요소를 가지고 정량화한다.</p>
<ul>
<li>채무 불이행 위험 : Probability of default</li>
<li>채무 불이행 노출 : Exposure at default</li>
<li>채무 불이행에 대한 손실 : Loss given default</li>
</ul>
<p><span class="math inline">\(\text{기대손실} = \text{채무 불이행 위험} \times \text{채무 불이행 노출} \times \text{채무 불이행에 대한 손실}\)</span></p>
<p>따라서 금융기관에서 자금을 빌려주기 전에 다양한 정보를 활용하여 채무 불이행 위험이 적은 고객을 선별하여 가능한 많은 금액을 빌려주어 매출과 수익을 극대화한다.</p>
<ul>
<li>Application 정보: 나이, 결혼여부, 소득, 자가/전세 등</li>
<li>Behaviour 정보: 현재 은행잔고, 연체금액 등</li>
</ul>
<h3 id="랜딩클럽-데이터">2. 랜딩클럽 데이터</h3>
<p><a href="https://www.lendingclub.com/info/download-data.action">LendingClub</a> 사이트에서 데이터를 다운로드해도 되고, <a href="https://www.kaggle.com/wendykan/lending-club-loan-data">캐글 대출 데이터(Kaggle Loan Data)</a>를 통해서 데이터를 구해도 좋다.</p>
<p>2007-2015까지 <a href="https://www.lendingclub.com/">LendingClub</a> 대출자료가 파일에 담겨있다. 다운로드 받아 압축을 풀면, 다음 파일 세개가 담겨있다.</p>
<ul>
<li>database.sqlite (134.64 MB) : sqlite 데이터베이스 파일 형식 대출 데이터 전체</li>
<li>LCDataDictionary.xlsx (20.5 KB) : 데이터 사전 (변수 설명)</li>
<li>loan.csv (105.01 MB) : csv 파일 형식 대출 데이터 전체</li>
</ul>
<p>``` {r lendingclub-import, tidy=FALSE, warning=FALSE}</p>
<h2 id="section">=====================================================================</h2>
<h2 id="렌딩클럽-데이터-가져오기">01. 렌딩클럽 데이터 가져오기</h2>
<h2 id="section-1">=====================================================================</h2>
<p>library(readr) library(dplyr) setwd(“D:/”) loan.dat &lt;- read_csv(“lending-club-loan-data/loan.csv”, col_names = TRUE) dim(loan.dat) names(loan.dat)</p>
<p>glimpse(loan.dat) summary(loan.dat) ```</p>
<p>``` {r lendingclub-recon, tidy=FALSE, warning=FALSE}</p>
<h2 id="section-2">=====================================================================</h2>
<h2 id="렌딩클럽-데이터와-문서-대조작업">02. 렌딩클럽 데이터와 문서 대조작업</h2>
<h2 id="section-3">=====================================================================</h2>
<p>library(readxl) dataDictionary &lt;- read_excel(“lending-club-loan-data/LCDataDictionary.xlsx”)</p>
<p>dd.names &lt;- as.character(na.omit(dataDictionary$LoanStatNew)) loandata.names &lt;- names(loan.dat)</p>
<p>setdiff(dd.names, loandata.names) ```</p>
<p>렌딩클럽 데이터(csv 혹은 sqlite)와 데이터 사전에 문서화된 것 사이에 차이가 남을 알 수 있다. 즉, “fico_range_high”, “fico_range_low”, “is_inc_v”, “last_fico_range_high”, “last_fico_range_low”, “verified_status_joint”, “total_rev_hi_lim” 변수는 데이터 사전에 등재되어 있지만, 실제 렌딩클럽 데이터에는 없다. 사실 이런 경우는 흔하게 발생되고 있는 문제로 나중에 심각한 문제가 될 수 있다. 즉, 이런 유산 비용이 쌓이게 되면 정말 되돌이킬 수 없는 시스템이 되어 재앙이 될 수 있다.</p>
<h4 id="탐색적-데이터-분석">2.1. 탐색적 데이터 분석</h4>
<p>``` {r lendingclub-eda-continuous, tidy=FALSE, warning=FALSE} ##===================================================================== ## 03. 렌딩클럽 데이터 탐색적 데이터 분석 ##===================================================================== # 02.01. 대출금액 분포 library(DescTools) Desc(loan.dat$loan_amnt, main = “대출금액 분포”, plotit = TRUE)</p>
<h1 id="대출금액-증가-현황">02.02. 대출금액 증가 현황</h1>
<p>library(ggplot2) library(lubridate)</p>
<p>loan.dat<span class="math inline">\(issue_d &lt;- parse_date_time(gsub(&quot;^&quot;, &quot;01-&quot;, loan.dat\)</span>issue_d), orders = c(“d-m-y”, “d-B-Y”, “m/d/y”))</p>
<p>amnt_df &lt;- loan.dat %&gt;% select(issue_d, loan_amnt) %&gt;% group_by(issue_d) %&gt;% summarise(Amount = sum(loan_amnt))</p>
<p>ts_amnt &lt;- ggplot(amnt_df, aes(x = issue_d, y = Amount)) ts_amnt + geom_line() + xlab(“대출금 발생일”) + ylab(“대출금”) ```</p>
<p>``` {r lendingclub-eda-loan-status, tidy=FALSE, warning=FALSE} # 03.03. 대출 상태</p>
<p>Desc(loan.dat$loan_status, plotit = T)</p>
<h1 id="대출-상태별-대출금">03.04. 대출 상태별 대출금</h1>
<p>box_status &lt;- ggplot(loan.dat, aes(loan_status, loan_amnt)) box_status + geom_boxplot(aes(fill = loan_status)) + theme(axis.text.x = element_blank()) + labs(list( title = “대출 상태별 대출금”, x = “대출상태”, y = “대출금”))</p>
<h1 id="대출-등급별-대출금-추이">03.05. 대출 등급별 대출금 추이</h1>
<p>amnt_df_grade &lt;- loan.dat %&gt;% select(issue_d, loan_amnt, grade) %&gt;% group_by(issue_d, grade) %&gt;% summarise(Amount = sum(loan_amnt))</p>
<p>ts_amnt_grade &lt;- ggplot(amnt_df_grade, aes(x = issue_d, y = Amount)) ts_amnt_grade + geom_area(aes(fill=grade)) + xlab(“대출일”)<br />
```</p>
<h4 id="지리정보-분석">2.2. 지리정보 분석</h4>
<p>``` {r lendingclub-geo, tidy=FALSE, warning=FALSE} ##===================================================================== ## 04. 렌딩클럽 데이터 지리정보 분석 ##=====================================================================</p>
<p>state.df &lt;- “State, Abbreviation, region Alabama, Ala., AL Alaska, Alaska, AK American Samoa, , AS Arizona, Ariz., AZ Arkansas, Ark., AR California, Calif., CA Colorado, Colo., CO Connecticut, Conn., CT Delaware, Del., DE Dist. of Columbia, D.C., DC Florida, Fla., FL Georgia, Ga., GA Guam, Guam, GU Hawaii, Hawaii, HI Idaho, Idaho, ID Illinois, Ill., IL Indiana, Ind., IN Iowa, Iowa, IA Kansas, Kans., KS Kentucky, Ky., KY Louisiana, La., LA Maine, Maine, ME Maryland, Md., MD Marshall Islands, , MH Massachusetts, Mass., MA Michigan, Mich., MI Micronesia, , FM Minnesota, Minn., MN Mississippi, Miss., MS Missouri, Mo., MO Montana, Mont., MT Nebraska, Nebr., NE Nevada, Nev., NV New Hampshire, N.H., NH New Jersey, N.J., NJ New Mexico, N.M., NM New York, N.Y., NY North Carolina, N.C., NC North Dakota, N.D., ND Northern Marianas, , MP Ohio, Ohio, OH Oklahoma, Okla., OK Oregon, Ore., OR Palau, , PW Pennsylvania, Pa., PA Puerto Rico, P.R., PR Rhode Island, R.I., RI South Carolina, S.C., SC South Dakota, S.D., SD Tennessee, Tenn., TN Texas, Tex., TX Utah, Utah, UT Vermont, Vt., VT Virginia, Va., VA Virgin Islands, V.I., VI Washington, Wash., WA West Virginia, W.Va., WV Wisconsin, Wis., WI Wyoming, Wyo., WY”</p>
<p>state.df &lt;- read_csv(state.df)</p>
<p>library(zipcode) data(zipcode.civicspace) zipcode.civicspace<span class="math inline">\(zip_code &lt;- substr(zipcode.civicspace\)</span>zip,1,3) zipcode.dic &lt;- zipcode.civicspace %&gt;% group_by(zip_code) %&gt;% select(zip_code, region=state) %&gt;% unique</p>
<p>loan.dat<span class="math inline">\(zip_code &lt;- substr(loan.dat\)</span>zip_code,1,3) loan.dat &lt;- left_join(loan.dat, zipcode.dic, by=“zip_code”)</p>
<p>loan.dat<span class="math inline">\(region &lt;- as.factor(loan.dat\)</span>region)</p>
<h2 id="주별-대출금액">주별 대출금액</h2>
<p>state_by_value &lt;- loan.dat %&gt;% group_by(region) %&gt;% dplyr::summarise(value = sum(loan_amnt, na.rm=TRUE)) %&gt;% ungroup</p>
<p>state_by_value &lt;- tapply(loan.dat<span class="math inline">\(loan_amnt, loan.dat\)</span>region, sum)/10^8</p>
<h1 id="install.packagesrcurl">install.packages(“RCurl”)</h1>
<h1 id="install.packageschoroplethrmaps">install.packages(“choroplethrMaps”)</h1>
<p>library(choroplethr) state_choropleth(state_by_value, title = “Value by State”)</p>
<h2 id="주별-대출-횟수">주별 대출 횟수</h2>
<p>loan.dat<span class="math inline">\(region &lt;- tolower(loan.dat\)</span>region) loan.dat &lt;- left_join(loan.dat, state.df, by=“region”)</p>
<p>state_by_volume &lt;- loan.dat %&gt;% group_by(state.y) %&gt;% dplyr::summarise(value = n()) %&gt;% ungroup</p>
<p>state_choropleth(na.omit(state_by_volume$state.y), title = “Volume by State”) ```</p>
<h4 id="대출-목적과-단어-구름">2.3. 대출 목적과 단어 구름</h4>
<p>``` {r lendingclub-purpose-wordcloud, tidy=FALSE, warning=FALSE}}</p>
<h2 id="section-4">=====================================================================</h2>
<h2 id="렌딩클럽-대출-목적와-단어구름">05. 렌딩클럽 대출 목적와 단어구름</h2>
<h2 id="section-5">=====================================================================</h2>
<h1 id="대출-목적">대출 목적</h1>
<p>Desc(loan.dat$purpose, main = “대출 목적”, plotit = TRUE)</p>
<h1 id="단어-구름">단어 구름</h1>
<p>library(tm) library(RColorBrewer) library(wordcloud)</p>
<p>loan_descriptions.corpus &lt;- Corpus(DataframeSource(data.frame(head(loan.dat[,“title”], n=10000)))) loan_descriptions.corpus &lt;- tm_map(loan_descriptions.corpus, removePunctuation) loan_descriptions.corpus &lt;- tm_map(loan_descriptions.corpus, content_transformer(tolower))</p>
<p>wordcloud(loan_descriptions.corpus, max.words = 100, random.order=FALSE, rot.per=0.30, use.r.layout=FALSE, colors=brewer.pal(8, “Paired”)) ```</p>
<h4 id="대출-등급과-이자율">2.4. 대출 등급과 이자율</h4>
<pre class="{r}"><code>##=====================================================================
## 06. 대출 등급과 이자율
##=====================================================================

Desc(loan.dat$grade, main = &quot;대출 등급&quot;, plotit = TRUE)

Desc(int_rate ~ grade, loan.dat, digits = 1, main = &quot;Interest rate by grade&quot;, plotit = TRUE)</code></pre>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="https://cran.r-project.org/doc/contrib/Sharma-CreditScoring.pdf">Guide to Credit Scoring in R</a><a href="#fnref1">↩</a></p></li>
<li id="fn2"><p><a href="http://www.r-bloggers.com/credit-scoring-in-r-101/">Credit Scoring in R 101</a><a href="#fnref2">↩</a></p></li>
<li id="fn3"><p><a href="http://www.r-bloggers.com/r-credit-scoring-woe-information-value-in-woe-package/">R Credit Scoring – WoE &amp; Information Value in woe Package</a><a href="#fnref3">↩</a></p></li>
<li id="fn4"><p><a href="http://www.r-bloggers.com/r-package-smbinning-optimal-binning-for-scoring-modeling/">R Package ‘smbinning’: Optimal Binning for Scoring Modeling</a><a href="#fnref4">↩</a></p></li>
</ol>
</div>
        </div>
      </div>
      </article>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/swcarpentry/lesson-template">Source</a>
        <a class="label swc-blue-bg" href="mailto:admin@software-carpentry.org">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
    <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
  </body>
</html>
