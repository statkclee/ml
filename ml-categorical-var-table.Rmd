---
layout: page
title: xwMOOC 기계학습
subtitle: 범주형 변수와 표
output:
  html_document: 
    keep_md: yes
  pdf_document:
    latex_engine: xelatex
mainfont: NanumGothic
---
 
> ## 학습목표 {.objectives}
>
> * 범주형 변수와 짝꿍인 표를 생성하는 작업흐름을 이해한다.

``` {r, include=FALSE}
source("tools/chunk-options.R")
library(ggplot2)
library(rapportools)
library(outliers)
library(nycflights13)
library(dplyr)
library(readr)
```

## 1. R로 표 작성 [^DescTools-table]

[^DescTools-table]: [Tables in R - A quick practical overview](https://cran.r-project.org/web/packages/DescTools/vignettes/TablesInR.pdf)

데이터를 표로 생성하는 것은 상황에 따라서 별것 아니기도 하지만, 매우 복잡한 작업이 되기도 한다.
종국에는 데이터를 계수하는 것으로 종결된다. 하지만, 2차원 이상일 경우, 
R로 표현되는 데이터 자료형이 다양하고, 기술적으로도 추상화 개념을 도입할 필요가 있다.
따라서, 데이터를 요구되는 표로 나타내고 처리하는데 경우에 따라서 매우 많은 함수를 취사선택하게 된다.

범주형 데이터분석은 표를 작성하면서 시작한다고 해도 과언은 아니다. R에는 2차원 혹은 다차원 표를 
가지고 작업하는데 필요한 도구가 상당히 많이 존재하지만 완벽하지는 않는다. `DescTools` 팩키지에는 
실무적인 측면에서 이런 간극을 매울 수 있는 도구를 일부 제공한다.

## 2. 표 생성

분할표(Contingency Table) 데이터를 R에 입력하는 방법은 다수 있다. 
다음 표는 Agresti (2007) p.39, 정당과 성별를 표로 작성한 교차표다. 
이를 R 데이터로 저장한다.

|       |   |         |   Party     |            |
|-------|---|---------|-------------|------------|
|       | 	| Democrat| Independent | Republican |
| Gender| M	| 762     | 327         | 468	     |
|       | F	| 484     | 239         | 477	     |

1. `TextToTable()` 함수 활용 : `DescTools` 팩키지에서 지원되는 함수.

``` {r}
txt <- "
  Democrat, Independent, Republican
M, 762, 327, 468
F, 484, 239, 477"
TextToTable(txt, sep=",", dimnames=c("gender", "party")) 
```

2. `as.table()` 함수와 `rbind()` 함수 사용

`rbind()` 함수와 `as.table()` 함수를 사용해서 입력 데이터를 `table` 자료형으로 변환시키고 나서,
`dimnames()` 함수로 표에 사용되는 라벨을 부여하여 분할표를 완성시킨다.

```{r}
tab <- as.table(rbind(c(762, 327, 468), c(484, 239, 477))) 

dimnames(tab) <- list(gender = c("M", "F"),
                      party = c("Democrat", "Independent", "Republican"))
tab
```

3. `matrix()` 함수를 사용

`matrix()` 함수를 사용하여 동일하게 표를 구성할 수도 있다. 이 경우 `byrow=TRUE`로 설정해서
행렬이 행으로 쌓이게 한다.

```{r}
as.table(matrix(c(762, 327, 468, 484, 239, 477), nrow=2, byrow=TRUE,
                dimnames=list(gender= c("M", "F"),
                              party = c("Democrat", "Independent", "Republican")))) 
```

4. 다차원 표

다차원 표, 예를 들어 $2 \times 2 \times 2$ 표를 생성할 경우 배열을 사용한다.
이럴 경우 첫번째 차원은 행, 두번째 차원은 열, 세번째 차원은 깊이 순으로 저장된다.

```{r}
salary <- array(
          c(38, 12, 102, 141, 12, 9, 136, 383),
          dim=c(2, 2, 2),
          dimnames=list(exposure = c("exposed", "not"),
                        disease = c("case", "control"),
                        salary = c("<1000", ">=1000"))
 ) 
```

`read.ftable()` 함수를 사용해서 고차원 표를 텍스트 파일로 표현된 정보를 표로 표현할 수도 있다.

```{r}
txt <-
"      Sex Male                   Female
       Eye Brown Blue Hazel Green Brown Blue Hazel Green
Hair
Black       32    11   10   3    36     9    5      2
Brown       53    50   25   15   66     34   29    14
Red         10    10   7    7    16     7    7      7
Blond       3     30   5    8    4      64   5      8
"
tab <- as.table(read.ftable(textConnection(txt))) 

tab
```

### 2.1. 숫자형 변수에서 범주형 자료 생성

`DescTools` 팩키지의 `Freq()` 함수를 활용해서 숫자형 변수를 범주형으로 표현하기 수월하다.
`Freq()` 함수는 `hist()`함수의 기본설정을 그대로 사용하여 숫자형 변수를 범주형으로 변경시킨다.

``` {r}
Freq(d.pizza$temperature) 
```

### 2.2. expand 기능 활용

빈도수가 크지 않는 표를 작성하는 경우 `expand.grid()` 함수를 활용하여 빈도수를 입력하는 것이 여러모로 편리하다.
요인을 expand.grid() 함수로 처리하고, 벡터로 빈도수를 `c()` 함수로 작성한다.
`expand.grid()` 함수로 요인사이 가능한 모든 조합을 표현하고, `count` 변수로 조합하여 데이터프레임으로 생성시킨다.
그리고 나서 `xtabs` 함수를 사용해서 표로 변환시킨다.

``` {r}
tab <- data.frame(expand.grid(
  Hair = c("Black", "Brown", "Red", "Blond"),
  Eye = c("Brown", "Blue", "Hazel", "Green"),
  Sex = c("Male", "Female")),
  count = c(32,53,10,3,11,50,10,30,10,25,7,5,3,15,7,8,
            36,66,16,4,9,34,7,64,5,29,7,5,2,14,7,8) )

tab %>% head
```


## 3. 범주형 데이터 구성

표를 작성하는데 있어 가장 먼저 확인해야 되는 사항은 범주형 자료구조를 확인하는데 있다.

1. **관측점 하나에 빈도수 하나인 경우**: `data.frame` 혹은 행렬에 원자료에 각행에 사례 한가지만 기록되어 
저장되어 있는 경우.

`Untable()` 함수는 데이터프레임을 입력받아 관측점 하나에 빈도수 하나인 데이터프레임으로 변환시킨다.

``` {r}
Untable(UCBAdmissions) %>% head
```

2. **빈도수(Frequency)**

각 요인별 조합을 유일무이한 값으로 계수하여 각 행에 저장함. 흔히 가중치(weights)라고도 하고,
`Freq` 칼럼이 이에 해당함.

``` {r}
data.frame(UCBAdmissions) %>% head
```

3. **표(Table)**

다차원 표, 배열, 행렬이 이에 해당.

``` {r}
UCBAdmissions[,,Dept=c("A", "B")]
```

세가지 범주형 데이터 표현방식은 각기 다른 사용도와 의미가 내포되어 있다. 예를 들어 2번 표현은 1번 표현보다 
훨씬 적은 저장공간을 차지하게 되고, 1번 표현방식은 즉각적으로 데이터를 표로 작성하는데 용이하다.


