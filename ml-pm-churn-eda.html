<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Software Carpentry: xwMOOC 기계학습</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="Software Carpentry Blog" href="http://software-carpentry.org/feed.xml"/>
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-59802572-17', 'auto');
      ga('send', 'pageview');
    
    </script>
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://software-carpentry.org" title="Software Carpentry">
          <img alt="Software Carpentry banner" src="img/software-carpentry-banner.png" />
        </a>
      </div>
      <article>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
                    <a href="index.html"><h1 class="title">xwMOOC 기계학습</h1></a>
          <h2 class="subtitle">고객 이탈(churn) - 탐색적 데이터 분석(EDA)</h2>
          <h2 id="import-attrition-dataset">데이터 가져오기 및 전처리</h2>
<p>고객이탈 <a href="https://community.watsonanalytics.com/wp-content/uploads/2015/03/WA_Fn-UseC_-Telco-Customer-Churn.csv">WA_Fn UseC_ Telco Customer Churn.csv</a> 데이터를 웹사이트에서 바로 불러들인다.</p>
<p>그리고 나서 <code>skimr</code> 팩키지 <code>skim</code> 함수를 통해 전반적인 데이터 현황을 살펴보고 나서, 전처리에 대한 전략을 수립한다. 전처리 전략에 바탕을 두고 차근차근 데이터 전처리 작업을 진행한다.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 0. 환경설정 --------------------------------------------------------------</span>
<span class="co"># library(tidyverse)</span>
<span class="co"># library(corrplot)</span>
<span class="co"># library(gridExtra)</span>
<span class="co"># library(ggthemes)</span>
<span class="co"># library(caret)</span>
<span class="co"># library(randomForest)</span>
<span class="co"># library(party)</span>
<span class="co"># library(purrr)</span>
<span class="co"># library(extrafont)</span>
<span class="co"># library(forcats)</span>
<span class="co"># library(skimr)</span>
<span class="co"># library(doParallel)</span>
<span class="co"># loadfonts()</span>

<span class="co"># 1. 데이터 가져오기 --------------------------------------------------------------</span>

<span class="co"># churn_dat &lt;- read_csv(&quot;https://community.watsonanalytics.com/wp-content/uploads/2015/03/WA_Fn-UseC_-Telco-Customer-Churn.csv&quot;)</span>

<span class="co"># 2. 데이터 전처리 --------------------------------------------------------------</span>
## 2.0. 현황파악 --------------
<span class="kw">skim</span>(churn_dat)</code></pre></div>
<pre class="output"><code>Numeric Variables
# A tibble: 4 x 13
  var    type  missing complete     n    mean      sd   min `25% quantile`
  &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;          &lt;dbl&gt;
1 Month… nume…     0       7043  7043 6.48e⁺¹ 3.01e⁺¹  18.2          35.5 
2 Senio… inte…     0       7043  7043 1.62e⁻¹ 3.69e⁻¹   0             0   
3 tenure inte…     0       7043  7043 3.24e⁺¹ 2.46e⁺¹   0             9.00
4 Total… nume…    11.0     7032  7043 2.28e⁺³ 2.27e⁺³  18.8         401   
# ... with 4 more variables: median &lt;dbl&gt;, `75% quantile` &lt;dbl&gt;,
#   max &lt;dbl&gt;, hist &lt;chr&gt;

Character Variables
# A tibble: 17 x 9
   var           type    complete missing empty     n   min   max n_unique
   &lt;chr&gt;         &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
 1 Churn         charac…     7043       0     0  7043  2.00  3.00     2.00
 2 Contract      charac…     7043       0     0  7043  8.00 14.0      3.00
 3 customerID    charac…     7043       0     0  7043 10.0  10.0   7043   
 4 Dependents    charac…     7043       0     0  7043  2.00  3.00     2.00
 5 DeviceProtec… charac…     7043       0     0  7043  2.00 19.0      3.00
 6 gender        charac…     7043       0     0  7043  4.00  6.00     2.00
 7 InternetServ… charac…     7043       0     0  7043  2.00 11.0      3.00
 8 MultipleLines charac…     7043       0     0  7043  2.00 16.0      3.00
 9 OnlineBackup  charac…     7043       0     0  7043  2.00 19.0      3.00
10 OnlineSecuri… charac…     7043       0     0  7043  2.00 19.0      3.00
11 PaperlessBil… charac…     7043       0     0  7043  2.00  3.00     2.00
12 Partner       charac…     7043       0     0  7043  2.00  3.00     2.00
13 PaymentMethod charac…     7043       0     0  7043 12.0  25.0      4.00
14 PhoneService  charac…     7043       0     0  7043  2.00  3.00     2.00
15 StreamingMov… charac…     7043       0     0  7043  2.00 19.0      3.00
16 StreamingTV   charac…     7043       0     0  7043  2.00 19.0      3.00
17 TechSupport   charac…     7043       0     0  7043  2.00 19.0      3.00
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## 2.1. 변수 결측값 --------------
<span class="kw">map</span>(churn_dat, ~<span class="st"> </span><span class="kw">sum</span>(<span class="kw">is.na</span>(.))) %&gt;%<span class="st"> </span><span class="kw">keep</span>( function(x) x &gt;<span class="st"> </span><span class="dv">0</span>)</code></pre></div>
<pre class="output"><code>$TotalCharges
[1] 11
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">churn_dat &lt;-<span class="st"> </span>churn_dat %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">complete.cases</span>(TotalCharges))

## 2.2. 주요 변수 Recode --------

churn_dat &lt;-<span class="st"> </span>churn_dat %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">OnlineSecurity   =</span> <span class="kw">ifelse</span>(OnlineSecurity ==<span class="st">&quot;No internet service&quot;</span>, <span class="st">&quot;No&quot;</span>, OnlineSecurity),
         <span class="dt">OnlineBackup     =</span> <span class="kw">ifelse</span>(OnlineBackup ==<span class="st">&quot;No internet service&quot;</span>, <span class="st">&quot;No&quot;</span>, OnlineBackup),
         <span class="dt">DeviceProtection =</span> <span class="kw">ifelse</span>(DeviceProtection ==<span class="st">&quot;No internet service&quot;</span>, <span class="st">&quot;No&quot;</span>, DeviceProtection),
         <span class="dt">TechSupport      =</span> <span class="kw">ifelse</span>(TechSupport ==<span class="st">&quot;No internet service&quot;</span>, <span class="st">&quot;No&quot;</span>, TechSupport),
         <span class="dt">StreamingTV      =</span> <span class="kw">ifelse</span>(StreamingTV ==<span class="st">&quot;No internet service&quot;</span>, <span class="st">&quot;No&quot;</span>, StreamingTV),
         <span class="dt">StreamingMovies  =</span> <span class="kw">ifelse</span>(StreamingMovies ==<span class="st">&quot;No internet service&quot;</span>, <span class="st">&quot;No&quot;</span>, StreamingMovies),
         <span class="dt">MultipleLines    =</span> <span class="kw">ifelse</span>(MultipleLines ==<span class="st">&quot;No phone service&quot;</span>, <span class="st">&quot;No&quot;</span>, MultipleLines))

churn_dat %&gt;%<span class="st"> </span><span class="kw">select</span>(OnlineSecurity, OnlineBackup, DeviceProtection, TechSupport, StreamingTV, StreamingMovies, MultipleLines) %&gt;%
<span class="st">  </span>purrr::<span class="kw">map</span>(., table)</code></pre></div>
<pre class="output"><code>$OnlineSecurity

  No  Yes 
5017 2015 

$OnlineBackup

  No  Yes 
4607 2425 

$DeviceProtection

  No  Yes 
4614 2418 

$TechSupport

  No  Yes 
4992 2040 

$StreamingTV

  No  Yes 
4329 2703 

$StreamingMovies

  No  Yes 
4301 2731 

$MultipleLines

  No  Yes 
4065 2967 
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">churn_dat &lt;-<span class="st"> </span>churn_dat %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tenure_grp =</span> <span class="kw">case_when</span>( tenure &lt;=<span class="st"> </span><span class="dv">12</span> ~<span class="st"> &quot;00-12개월&quot;</span>,
                                 tenure &lt;=<span class="st"> </span><span class="dv">24</span> ~<span class="st"> &quot;13-24개월&quot;</span>,
                                 tenure &lt;=<span class="st"> </span><span class="dv">36</span> ~<span class="st"> &quot;25-36개월&quot;</span>,
                                 tenure &lt;=<span class="st"> </span><span class="dv">48</span> ~<span class="st"> &quot;37-48개월&quot;</span>,
                                 tenure &lt;=<span class="st"> </span><span class="dv">60</span> ~<span class="st"> &quot;49-60개월&quot;</span>,
                                 tenure  &gt;<span class="st"> </span><span class="dv">60</span> ~<span class="st"> &quot;60개월이상&quot;</span>))

churn_dat &lt;-<span class="st"> </span>churn_dat %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">SeniorCitizen  =</span> <span class="kw">ifelse</span>(SeniorCitizen ==<span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;No&quot;</span>, <span class="st">&quot;Yes&quot;</span>))

## 2.3. 무의미한 변수 제거 --------
churn_dat &lt;-<span class="st"> </span>churn_dat %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(-customerID, -tenure)

## 2.4. 자료형 변환 --------
churn_df &lt;-<span class="st"> </span><span class="kw">map_if</span>(churn_dat, is.character, as.factor) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">as_data_frame</span>()

## 2.5. 데이터 내보내기 - 저장 --------

<span class="co"># dir.create(&quot;data_processed&quot;)</span>
<span class="co"># saveRDS(churn_df, &quot;data_processed/churn_df.rds&quot;)</span></code></pre></div>
<h2 id="eda-attrition-dataset">탐색적 데이터 분석(EDA)</h2>
<p>데이터를 숫자형 데이터와 범주형 데이터로 나눠서 연속형 변수의 경우 상관관계를 <code>corrplot</code> 팩키지를 통해 탐색적으로 분석하고, 범주형 변수는 “고객이탈” 변수와 교차분석을 막대그래프로 수행하여 살펴본다.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 2. 탐색적 데이터 분석(EDA) --------------------------------------------------------------</span>

## 2.1. 상관 분석

numeric_var &lt;-<span class="st"> </span><span class="kw">map</span>(churn_df, is.numeric) %&gt;%<span class="st"> </span><span class="kw">keep</span>(., function(x) x ==<span class="st"> </span><span class="ot">TRUE</span>) %&gt;%<span class="st"> </span>names

churn_df %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(numeric_var) %&gt;%<span class="st"> </span>
<span class="st">    </span><span class="kw">cor</span>() %&gt;%<span class="st"> </span>
<span class="st">    </span><span class="kw">corrplot</span>(<span class="dt">main=</span><span class="st">&quot;숫자형 변수에 대한 상관도&quot;</span>, <span class="dt">method=</span><span class="st">&quot;number&quot;</span>)</code></pre></div>
<p><img src="fig/eda-attrition-data-1.png" title="plot of chunk eda-attrition-data" alt="plot of chunk eda-attrition-data" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## 2.2. 단변량 분석

barplot_univariate &lt;-<span class="st">  </span>function(df, var, var_name) {
  <span class="kw">ggplot</span>(df, <span class="kw">aes_string</span>(<span class="dt">x=</span>var)) +<span class="st"> </span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="dv">100</span>*(..count..)/<span class="kw">sum</span>(..count..)), <span class="dt">width =</span> <span class="fl">0.5</span>) +<span class="st"> </span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">x=</span>var_name, <span class="dt">y=</span><span class="st">&quot;비율&quot;</span>, <span class="dt">title=</span>var_name) +
<span class="st">    </span><span class="kw">coord_flip</span>() +<span class="st"> </span>
<span class="st">    </span><span class="kw">theme_few</span>(<span class="dt">base_family =</span> <span class="st">&quot;NanumGothic&quot;</span>)
}

uni_p1 &lt;-<span class="st"> </span><span class="kw">barplot_univariate</span>(churn_df, <span class="st">&quot;gender&quot;</span>, <span class="st">&quot;성별&quot;</span>)
uni_p2 &lt;-<span class="st"> </span><span class="kw">barplot_univariate</span>(churn_df, <span class="st">&quot;SeniorCitizen&quot;</span>, <span class="st">&quot;노인우대&quot;</span>)
uni_p3 &lt;-<span class="st"> </span><span class="kw">barplot_univariate</span>(churn_df, <span class="st">&quot;Partner&quot;</span>, <span class="st">&quot;파트너사&quot;</span>)
uni_p4 &lt;-<span class="st"> </span><span class="kw">barplot_univariate</span>(churn_df, <span class="st">&quot;Dependents&quot;</span>, <span class="st">&quot;결합&quot;</span>)
uni_p5 &lt;-<span class="st"> </span><span class="kw">barplot_univariate</span>(churn_df, <span class="st">&quot;PhoneService&quot;</span>, <span class="st">&quot;유선전화&quot;</span>)
uni_p6 &lt;-<span class="st"> </span><span class="kw">barplot_univariate</span>(churn_df, <span class="st">&quot;MultipleLines&quot;</span>, <span class="st">&quot;다중회선&quot;</span>)
uni_p7 &lt;-<span class="st"> </span><span class="kw">barplot_univariate</span>(churn_df, <span class="st">&quot;InternetService&quot;</span>, <span class="st">&quot;인터넷&quot;</span>)
uni_p8 &lt;-<span class="st"> </span><span class="kw">barplot_univariate</span>(churn_df, <span class="st">&quot;OnlineSecurity&quot;</span>, <span class="st">&quot;온라인 보안 서비스&quot;</span>)

<span class="kw">grid.arrange</span>(uni_p1, uni_p2, uni_p3, uni_p4, uni_p5, uni_p6, uni_p7, uni_p8, <span class="dt">ncol=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="fig/eda-attrition-data-2.png" title="plot of chunk eda-attrition-data" alt="plot of chunk eda-attrition-data" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">uni_p9 &lt;-<span class="st"> </span><span class="kw">barplot_univariate</span>(churn_df, <span class="st">&quot;OnlineBackup&quot;</span>, <span class="st">&quot;온라인 백업&quot;</span>)
uni_p10 &lt;-<span class="st"> </span><span class="kw">barplot_univariate</span>(churn_df, <span class="st">&quot;DeviceProtection&quot;</span>, <span class="st">&quot;디바이스 보호&quot;</span>)
uni_p11 &lt;-<span class="st"> </span><span class="kw">barplot_univariate</span>(churn_df, <span class="st">&quot;TechSupport&quot;</span>, <span class="st">&quot;기술지원&quot;</span>)
uni_p12 &lt;-<span class="st"> </span><span class="kw">barplot_univariate</span>(churn_df, <span class="st">&quot;StreamingTV&quot;</span>, <span class="st">&quot;TV 스트리밍&quot;</span>)
uni_p13 &lt;-<span class="st"> </span><span class="kw">barplot_univariate</span>(churn_df, <span class="st">&quot;StreamingMovies&quot;</span>, <span class="st">&quot;영화 스트리밍&quot;</span>)
uni_p14 &lt;-<span class="st"> </span><span class="kw">barplot_univariate</span>(churn_df, <span class="st">&quot;Contract&quot;</span>, <span class="st">&quot;계약관련&quot;</span>)
uni_p15 &lt;-<span class="st"> </span><span class="kw">barplot_univariate</span>(churn_df, <span class="st">&quot;PaperlessBilling&quot;</span>, <span class="st">&quot;전자고지서&quot;</span>)
uni_p16 &lt;-<span class="st"> </span><span class="kw">barplot_univariate</span>(churn_df, <span class="st">&quot;PaymentMethod&quot;</span>, <span class="st">&quot;지불방법&quot;</span>)
uni_p17 &lt;-<span class="st"> </span><span class="kw">barplot_univariate</span>(churn_df, <span class="st">&quot;tenure_grp&quot;</span>, <span class="st">&quot;가입기간&quot;</span>)

<span class="kw">grid.arrange</span>(uni_p9, uni_p10, uni_p11, uni_p12, uni_p13, uni_p14, uni_p15, uni_p16, uni_p17, <span class="dt">ncol=</span><span class="dv">3</span>)</code></pre></div>
<p><img src="fig/eda-attrition-data-3.png" title="plot of chunk eda-attrition-data" alt="plot of chunk eda-attrition-data" style="display: block; margin: auto;" /></p>
        </div>
      </div>
      </article>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/swcarpentry/lesson-template">Source</a>
        <a class="label swc-blue-bg" href="mailto:admin@software-carpentry.org">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
    <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
  </body>
</html>
