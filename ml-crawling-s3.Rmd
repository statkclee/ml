---
layout: page
title: xwMOOC 기계학습
subtitle: 데이터 크롤링 &rarr; S3
author:
    name: xwMOOC
    url: https://www.facebook.com/groups/tidyverse/
    affiliation: Tidyverse Korea
date: "`r Sys.Date()`"
output:
  html_document: 
    toc: yes
    toc_float: true
    highlight: tango
    code_folding: show
    number_section: true
    self_contained: true
editor_options: 
  chunk_output_type: console
---
 
``` {r setup, include=FALSE}
# source("tools/chunk-options.R")

knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE,
                      comment="", digits = 3, tidy = FALSE, prompt = FALSE, fig.align = 'center')

```


# AWS 클라우드 {#epl-data-crawl}

<img src="fig/crawl-aws-ec2-s3.png" alt="EC2 크롤링" width="100%" />

# 데이터 가져오기 {#epl-data-crawl-import}

축구데이터: <https://github.com/jalapic/engsoccerdata>

```{r epl-data-import}
library(httr)
library(rvest)
library(tidyverse)
library(engsoccerdata) # install_github('jalapic/engsoccerdata', username = "jalapic")

epl_df <- england_current()

epl_df %>% tbl_df %>% 
    arrange(desc(Date))

england %>% tbl_df

spain_df <- spain_current()

```


# 안양축구 경기 크롤링 {#k-league-data-crawl}

삼성블루윙즈: <http://www.bluewings.kr/home>
FC안양: <http://www.fc-anyang.com/>


```{r kleague-crawl-data}
anyang_url <- "http://www.fc-anyang.com/match/match.asp?searchLeague=K%EB%A6%AC%EA%B7%B82"

anyang_resp <- POST(url = anyang_url)

status_code(x = anyang_resp)

anyang_df <- anyang_resp %>% 
  read_html() %>% 
  html_nodes(xpath= '//*[@id="container"]/div/table')  %>% 
  html_table() %>% 
  .[[1]] %>% 
  tbl_df()

anyang_df <- anyang_df %>% 
  setNames(c("날짜", "구장", "리그", "X1", "홈팀", "홈점수", "X2", "원정점수", "원정팀", "X3", "승부")) %>% 
  select_at(vars(-contains("X")))
  
DT::datatable(anyang_df)

anyang_filename <- paste0("anyang_", Sys.Date(), "_df.csv")

anyang_df %>% write_csv(anyang_filename)
```


# 아마존 AWS S3 저장 {#k-league-data-crawl-to-s3}


```{r football-s3, eval=FALSE}
library(aws.s3) # devtools::install_github("cloudyr/aws.s3")

# S3 버킷 접근을 위한 키값 설정
Sys.setenv("AWS_ACCESS_KEY_ID" = AWS_ACCESS_KEY_ID,
           "AWS_SECRET_ACCESS_KEY" = AWS_SECRET_ACCESS_KEY,
           "AWS_DEFAULT_REGION" = "ap-northeast-2")

put_object(file = anyang_filename, object = anyang_filename, bucket = "swcarpentry/football")
```

